%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[a4paper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\PassOptionsToPackage{svgnames}{xcolor}
\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
\edef\sphinxdqmaybe{\ifdefined\DeclareUnicodeCharacterAsOptional\string"\fi}
  \DeclareUnicodeCharacter{\sphinxdqmaybe00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}
\sphinxsetup{VerbatimColor={named}{OldLace}}
\fvset{fontsize=\small}
\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}
\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@ }}
\makeatletter
\def\fnum@figure{\figurename\thefigure{}}
\makeatother
\addto\captionsenglish{\renewcommand{\tablename}{Table }}
\makeatletter
\def\fnum@table{\tablename\thetable{}}
\makeatother
\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{continued from previous page}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{continues on next page}}
\addto\captionsenglish{\renewcommand{\sphinxnonalphabeticalgroupname}{Non-alphabetical}}
\addto\captionsenglish{\renewcommand{\sphinxsymbolsname}{Symbols}}
\addto\captionsenglish{\renewcommand{\sphinxnumbersname}{Numbers}}

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}



\title{GenChem Documentation}
\date{Jan 13, 2020}
\release{}
\author{David Simpson}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{Introduction}
\label{\detokenize{GenChemDoc_intro:introduction}}\label{\detokenize{GenChemDoc_intro::doc}}
GenChem is a system to generate and test chemical mechanisms for the
EMEP MSC-W model {[}Simpson2012{]} and 1-D canopy model, ESX {[}SimpsonTuovinen2014{]}.
GenChem consists of two main directories, \sphinxstylestrong{chem} and \sphinxstylestrong{box}.

The \sphinxstylestrong{chem} directory contains several chemical mechanisms written
in chemist-friendly format (e.g. \sphinxstyleemphasis{k1}  NO2 + OH = HNO3).
A python script \sphinxstyleemphasis{GenChem.py} can be used to convert these files
to fortran friendly input files for the EMEP model, usually with the help
of some wrapper script, either \sphinxstyleemphasis{do.GenChem}, \sphinxstyleemphasis{do.testChems}, or \sphinxstyleemphasis{emep\_setup.py}.
The fortran files produced by these scripts
have the prefix “{\color{red}\bfseries{}CM\_}” or “{\color{red}\bfseries{}CMX\_}”, where CM denotes Chemical Mechanism.

Although GenChem can be run directly from within the \sphinxstylestrong{chem} directory,
the strongly recommended  approach is to use the scripts available
in the \sphinxstylestrong{box} directory. In this approach GenChem is first applied, and
then the resulting CM files are compiled and run
as box-model simulations. Once all looks okay, a final script
can be run to add additional code, and provide an EMEP-ready
set of fortran files. This approach ensures that the CM files
compile as they should, and allows rapid testing of several chemical
mechanisms alongside each other.


\section{Code structure}
\label{\detokenize{GenChemDoc_intro:code-structure}}
The directory structure for GenChem can be summarised as:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{chem}                 \PYG{c+c1}{\PYGZsh{} GenChem\PYGZsq{}s mechanism tree}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{chem}\PYG{o}{/}\PYG{n}{scripts}         \PYG{c+c1}{\PYGZsh{} scripts, including do.GenChem and GenChem.py}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{chem}\PYG{o}{/}\PYG{n}{base\PYGZus{}mechanisms} \PYG{c+c1}{\PYGZsh{} collection of main chemical schemes}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{chem}\PYG{o}{/}\PYG{n}{extra\PYGZus{}mechanisms} \PYG{c+c1}{\PYGZsh{} collection of extra reactions for chemical schemes}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{chem}\PYG{o}{/}\PYG{n}{inputs}           \PYG{c+c1}{\PYGZsh{} emissplit files, see ...}

\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{box}                 \PYG{c+c1}{\PYGZsh{} Top of ESX directory tree}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{box}\PYG{o}{/}\PYG{n}{src}             \PYG{c+c1}{\PYGZsh{} source files}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{box}\PYG{o}{/}\PYG{n}{scripts}         \PYG{c+c1}{\PYGZsh{} scripts}

\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{doc}              \PYG{c+c1}{\PYGZsh{} documentation, as .rst files plus sphinx conf system}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{doc}\PYG{o}{/}\PYG{n}{\PYGZus{}build}       \PYG{c+c1}{\PYGZsh{} processed documentation, as .pdf and html}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{doc}\PYG{o}{/}\PYG{n}{\PYGZus{}build}\PYG{o}{/}\PYG{n}{html}  \PYG{c+c1}{\PYGZsh{}  .. as .html  (aim your browser at index.html here)}
\PYG{n}{XXX}\PYG{o}{/}\PYG{n}{doc}\PYG{o}{/}\PYG{n}{\PYGZus{}build}\PYG{o}{/}\PYG{n}{latex} \PYG{c+c1}{\PYGZsh{} .. as .pdf  (aim your pdfreader at GenChemDoc.pdf here)}
\end{sphinxVerbatim}

(where XXX could any suitable user-directory into which GenChem was unpacked, e.g. /home/fred/chemwork/GenChem.)


\section{Requirements}
\label{\detokenize{GenChemDoc_intro:requirements}}
GenChem has been developed on Ubuntu linux systems, and
should work on any modern linux/unix computer. The code has also been
run on Windows via a virtual ubuntu environment.
The minumum requirements are a modern fortran compiler and python3
(probably 3.5 or higher).

We have used for example
\begin{itemize}
\item {} 
gfortran (gcc 4.6.1) on Linux Xubuntu PC system

\item {} 
gfortran (gcc 4.4.7) on HP supercomputer

\item {} 
ifort 13.0.1

\end{itemize}

\begin{sphinxadmonition}{warning}{Warning:}
**  NOTE !!
This user-guide is a work-in-progress manual on the GenChem system,
with this interim version produced for interested users, Jan. 2020.
**
\end{sphinxadmonition}


\chapter{Quick start}
\label{\detokenize{GenChemDoc_quickstart:quick-start}}\label{\detokenize{GenChemDoc_quickstart::doc}}
We will proceed directly to a run of the box-model system, to show how
chemical schemes are normally compiled into \sphinxcode{\sphinxupquote{CM\_}} and \sphinxcode{\sphinxupquote{CMX\_}} files, and used
in box-model simulations. This is actually the normal and recommended way to
prepare files for the EMEP model, but also provides a good environment for
comparing chemical mechanisms.


\section{Step 1: initial setup}
\label{\detokenize{GenChemDoc_quickstart:step-1-initial-setup}}
If not run previously, some preliminary steps are needed to set up a
working directory.  From the \sphinxstylestrong{GenChem/box} directory (cd
GenChem/box), do:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cd} \PYG{n}{somepath}\PYG{o}{/}\PYG{n}{GenChem}\PYG{o}{\PYGZhy{}}\PYG{n}{xxx}\PYG{o}{/}\PYG{n}{box}
\PYG{n}{mkdir} \PYG{n}{tmp\PYGZus{}work}

\PYG{n}{cd} \PYG{n}{tmp\PYGZus{}work}\PYG{o}{/}

\PYG{n}{cp} \PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{src}\PYG{o}{/}\PYG{o}{*}\PYG{o}{.}\PYG{n}{f90} \PYG{o}{.}
\PYG{n}{cp} \PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{src}\PYG{o}{/}\PYG{n}{Makefile} \PYG{o}{.}
\PYG{n}{cp} \PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{src}\PYG{o}{/}\PYG{n}{config\PYGZus{}box}\PYG{o}{.}\PYG{n}{nml} \PYG{o}{.}
\PYG{n}{cp} \PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{scripts}\PYG{o}{/}\PYG{n}{do}\PYG{o}{.}\PYG{n}{testChems} \PYG{o}{.}
\PYG{n}{cp} \PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{scripts}\PYG{o}{/}\PYG{n}{emep\PYGZus{}setup}\PYG{o}{.}\PYG{n}{py} \PYG{o}{.}
\end{sphinxVerbatim}

If you want, the script box\_setup.sh from the box/scripts directory can also be
used to perform the above steps:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cd} \PYG{n}{somepath}\PYG{o}{/}\PYG{n}{GenChem}\PYG{o}{\PYGZhy{}}\PYG{n}{xxx}\PYG{o}{/}\PYG{n}{box}
\PYG{n}{scripts}\PYG{o}{/}\PYG{n}{box\PYGZus{}setup}\PYG{o}{.}\PYG{n}{sh} \PYG{n}{tmp\PYGZus{}work}
\end{sphinxVerbatim}


\section{Step 2: do.testChems}
\label{\detokenize{GenChemDoc_quickstart:step-2-do-testchems}}
At this stage, one can try compiling a chemical scheme. With the example of
EmChem19, and now from our tmp\_work directory, try:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{do}\PYG{o}{.}\PYG{n}{testChems}  \PYG{n}{EmChem19a}
\end{sphinxVerbatim}

This script will run GenChem.py on the EmChem19a scheme (also adding
a few extra reactions from a helper BoxAero mechanism), run “make”, and then
run the resulting box-model code. Results will appear in
one log-file (RES.EmChem19a, way too wordy!), and as comma-separated
results in the Output directory:  file boxEmChem19a.csv.
This file is readable with e.g. libreoffice. Plot scripts are
also available (see BELOW), for easy visualisation and
comparison of these csv results.

The \sphinxcode{\sphinxupquote{CM\_}} and \sphinxcode{\sphinxupquote{CMX\_}} fortran files produced by this process are saved in directories, e.g.
here in  \sphinxcode{\sphinxupquote{ZCMBOX\_EmChem19a}}. These files could be used in the EMEP model if wanted,
but usually the more complex script emep\_setup.py (described below) is
used for that. (Hence we reserve the prefix ZCMBOX for files created by do.testChems
and ZCM for those created with emep\_setup.py, see below.)

Now, if one wants to compare several schemes, one can do e.g.:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{do}\PYG{o}{.}\PYG{n}{testChems}  \PYG{n}{EmChem19a} \PYG{n}{CRI}\PYG{o}{\PYGZhy{}}\PYG{n}{R5}\PYG{o}{\PYGZhy{}}\PYG{n}{emep} \PYG{n}{MCM\PYGZus{}v3}\PYG{o}{.}\PYG{l+m+mi}{3}
\end{sphinxVerbatim}

This would produce 3 output .csv files, which again are easily plotted
against each other.

Technical comments:
\begin{itemize}
\item {} 
do.testChems is just a simple wrapper, which cleans up files, runs another script (do.GenChem), and runs the box model.

\item {} 
MCM is a very large scheme and this can take a while, or stress your PC’s memory! Try with the smaller schemes first.

\end{itemize}


\section{2a. Plotting?}
\label{\detokenize{GenChemDoc_quickstart:a-plotting}}
If one has run say 3 chemical schemes using Step 2 above, the results
are easily plotted from the \sphinxstyleemphasis{box/tmp\_work/Output} directory:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
../../scripts/boxplots.py \PYGZhy{}h     for help!

../../scripts/boxplots.py \PYGZhy{}v O3 \PYGZhy{}i boxEmChem19a.csv boxChem1.csv boxChem2.csv  \PYGZhy{}p
\end{sphinxVerbatim}

Using ‘ALL’ or ‘DEF’ with -v results in all or many common species being plotted at once (-p is assumed
in this case. For example, here we can see a comparison of three schemes produced with this script:

\noindent{\hspace*{\fill}\sphinxincludegraphics[scale=0.8]{{Comp_ppt_HO2_AeroCRI-R5-emep_AeroEmChem19a_AeroMCM_v3pt3}.png}\hspace*{\fill}}

Another crude+helpful script just grabs the concentrations:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{o}{.}\PYG{o}{.}\PYG{o}{/}\PYG{n}{scripts}\PYG{o}{/}\PYG{n}{getboxconcs}\PYG{o}{.}\PYG{n}{py}  \PYG{n}{O3} \PYG{n}{boxEmChem19a}\PYG{o}{.}\PYG{n}{csv}
\end{sphinxVerbatim}

which results in ResConcs\_boxEmChem19a\_O3\_ppb.txt


\section{2b. Box-config}
\label{\detokenize{GenChemDoc_quickstart:b-box-config}}
The script do.testChems above compiles the executable boxChem for each mechanism in turn, and by default runs this using some settings from the default config\_box.nml file. This file contains a number of important settings which by deault run a 24-hour simulation (starting at 12:00 GMT), with set emissions, temperature of 298.15 K, mixing height of 1000 m, and some boundary conditions. Default outputs are also given.

The user can of course change these settings (do this in your working directory, not in \sphinxstyleemphasis{src}). We explain the variables and choices here.

\sphinxstyleemphasis{Note} these config files follow fortran namelist conventions. Text following
an exclamation mark (!) is ignored.


\subsection{Time-related variables}
\label{\detokenize{GenChemDoc_quickstart:time-related-variables}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
! Time variables, all in seconds
! \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
 tstart = 43200., ! start at 12:00
! end time is absolute time \PYGZhy{}\PYGZgt{} total runtime is tend \PYGZhy{} tstart!
 tend = 302400.,  ! three days on top of 12 hours
 dt = 30.         ! time\PYGZhy{}step for numerical simulations
 doy = 182,        ! Day of the year
\end{sphinxVerbatim}


\subsection{Geographical location}
\label{\detokenize{GenChemDoc_quickstart:geographical-location}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
lat = 45.05,    ! degrees N
lon = 15.06,    ! degrees E
\end{sphinxVerbatim}


\subsection{Emissions}
\label{\detokenize{GenChemDoc_quickstart:emissions}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
 use\PYGZus{}emis = T,     ! use emissions at all?
! directory with emissplit files:
 emissplit\PYGZus{}dir = \PYGZsq{}emissplit\PYGZus{}run/\PYGZsq{}
 emis\PYGZus{}kgm2day = \PYGZsq{}nox\PYGZsq{}, 18.3, ! NOx, kg/m2/day, as in MCM/CRI tests
                \PYGZsq{}voc\PYGZsq{}, 15.4  ! NMVOC
 !emis\PYGZus{}kgm2day = \PYGZsq{}nox\PYGZsq{}, 180.3, ! NOx, kg/m2/day, as in MCM/CRI tests
 !               \PYGZsq{}voc\PYGZsq{}, 150.4  ! NMVOC

 ! BVOC emissions.
 ! The following emissions will be modulated by light
 rcbio\PYGZus{}isopMax  = 1.0e11, ! molec/cm2/s  isoprene
 rcbio\PYGZus{}mtlMax   = 0.5e11, ! molec/cm2/s  monoterpenes from light\PYGZhy{}dependent emissions
 rcbio\PYGZus{}mtp      = 0.5e11,
\end{sphinxVerbatim}


\section{Step 3: emep\_setup.py}
\label{\detokenize{GenChemDoc_quickstart:step-3-emep-setup-py}}
The do.testChems script described above is best for quickly testing and
comparing different mechanisms. Usually these comparisons only involve
gas-phase mechanisms such as EmChem19a or MCM\_v3.3. However, the EMEP
model usually requires a host of extra species and reactions to
accommodate sea-salt, dust, organic aerosols, and pollen.
It also requires files to specify how emissions and boundary
conditions should be distributed among specific species, e.g.
how a VOC emission should be split into C2H6, C2H4, nC4H10 etc.

In fact, for the EMEP model, GenChem produces many files which are
copied into ZCM\_XXX directories for the scheme XXX you wish to use:
\begin{quote}

\$ls -x ZCM\_EmChem19a/
\begin{quote}

CM\_ChemDims\_mod.f90                     CM\_ChemGroups\_mod.f90
CM\_ChemRates\_mod.f90                    CM\_ChemSpecs\_mod.f90
CM\_DryDep.inc                           CM\_EmisFile.inc
CM\_emislist.csv                         CM\_EmisSpecs.inc
CM\_Reactions1.inc                       CM\_Reactions2.inc
CM\_Reactions.log                        CM\_WetDep.inc
CMX\_BiomassBurningMapping\_FINNv1.5.txt  CMX\_BiomassBurningMapping\_GFASv1.txt
CMX\_BoundaryConditions.txt              config\_box.nml
run\_emislist/  (with emislist.defaults.sox etc..)
\end{quote}
\end{quote}

The recommended way to get this directory is to use the script \sphinxstyleemphasis{emep\_setup.py} from your temporary work directory
within  the \sphinxstylestrong{box} system. So, from e.g. box/tmp\_work, do:
\begin{quote}

./emep\_setup.py  EmChem19a
\end{quote}

or just:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{.}\PYG{o}{/}\PYG{n}{emep\PYGZus{}setup}\PYG{o}{.}\PYG{n}{py}
\end{sphinxVerbatim}

and this will provide a list of options.

You can edit the \sphinxstyleemphasis{emep\_setup.py} scripts, maybe renaming it as \sphinxstyleemphasis{my\_setup.py} directory.
If selecting from the provided base\_mechanisms and extra\_mechanisms you only need to extend
the possible command lines as provided by the \sphinxstyleemphasis{cmdx}  dictionary:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cmdx}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{EmChem19a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}b EmChem19a \PYGZhy{}e PM\PYGZus{}VBS\PYGZus{}EmChem19 BVOC\PYGZus{}MTERP1\PYGZus{}EmChem19}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{common}
\PYG{n}{cmdx}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CRI\PYGZhy{}R5\PYGZhy{}emep}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}b CRI\PYGZhy{}R5\PYGZhy{}emep \PYGZhy{}e common}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

The ‘-b’ argument gives the base mechanism, and then you can have any number of compatable extra mechanisms (-e argument).

Any keys from \sphinxstyleemphasis{cmdx} can be used by \sphinxstyleemphasis{emep\_setup.py}. For example, if the user builds a new base scheme \sphinxstyleemphasis{usersChem} and
some OA scheme, \sphinxstyleemphasis{usersSOA}, then \sphinxstyleemphasis{emep\_setup.py} can be edited to add these as a new option:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cmdx}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{usersChem}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}b usersChem \PYGZhy{}e  usersSOA}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{common}
\end{sphinxVerbatim}

you could do:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{do}\PYG{o}{.}\PYG{n}{testChems} \PYG{n}{usersChem}   \PYG{c+c1}{\PYGZsh{} GOOD TO CHECK FIRST}

\PYG{n}{emep\PYGZus{}setup}\PYG{o}{.}\PYG{n}{py} \PYG{n}{usersChem}  \PYG{c+c1}{\PYGZsh{} Creates ZCM\PYGZus{}usersChem}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{warning}{Warning:}
**  NOTE !!
This user-guide is a work-in-progress manual on the GenChem system,
with this interim version produced for interested users, Jan. 2020.
**
\end{sphinxadmonition}


\chapter{Formatting of GenChem files}
\label{\detokenize{GenChemDoc_chem:formatting-of-genchem-files}}\label{\detokenize{GenChemDoc_chem::doc}}

\section{Reactions files}
\label{\detokenize{GenChemDoc_chem:reactions-files}}
Example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{*} \PYG{n}{Some} \PYG{n}{simple} \PYG{n}{lines}
\PYG{l+m+mf}{1.4e\PYGZhy{}12}\PYG{o}{*}\PYG{n}{EXP}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1310.}\PYG{o}{*}\PYG{n}{TINV}\PYG{p}{)}          \PYG{p}{:} \PYG{n}{O3} \PYG{o}{+} \PYG{n}{NO}    \PYG{o}{=} \PYG{n}{NO2} \PYG{o}{+} \PYG{o}{\PYGZlt{}}\PYG{n}{O2}\PYG{o}{\PYGZgt{}}  \PYG{p}{;} \PYG{n}{acp2004}
\PYG{l+m+mf}{5.681e\PYGZhy{}34}\PYG{o}{*}\PYG{n}{EXP}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{2.6}\PYG{o}{*}\PYG{n}{LogTdiv300}\PYG{p}{)}    \PYG{p}{:} \PYG{n}{OP} \PYG{o}{+} \PYG{o}{\PYGZlt{}}\PYG{n}{O2}\PYG{o}{\PYGZgt{}} \PYG{o}{+} \PYG{o}{\PYGZlt{}}\PYG{n}{M}\PYG{o}{\PYGZgt{}}  \PYG{o}{=} \PYG{n}{O3} \PYG{p}{;} \PYG{n}{acp2004}
\PYG{l+m+mf}{2.15e\PYGZhy{}11}\PYG{o}{*}\PYG{n}{EXP}\PYG{p}{(}\PYG{l+m+mf}{110.}\PYG{o}{*}\PYG{n}{TINV}\PYG{p}{)}           \PYG{p}{:} \PYG{n}{OD} \PYG{o}{+} \PYG{o}{\PYGZlt{}}\PYG{n}{N2}\PYG{o}{\PYGZgt{}}  \PYG{o}{=} \PYG{n}{OP}       \PYG{p}{;} \PYG{n}{Updated} \PYG{p}{(}\PYG{n}{IUPAC} \PYG{l+m+mi}{2009}\PYG{p}{)}

\PYG{n}{emisfiles}\PYG{p}{:}\PYG{n}{sox}\PYG{p}{,}\PYG{n}{nox}\PYG{p}{,}\PYG{n}{co}\PYG{p}{,}\PYG{n}{voc}\PYG{p}{,}\PYG{n}{nh3}
\PYG{n}{rcemis}\PYG{p}{(}\PYG{n}{NO}\PYG{p}{,}\PYG{n}{KDIM}\PYG{p}{)}                        \PYG{p}{:} \PYG{o}{=} \PYG{n}{NO}  \PYG{p}{;}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
END-OF-LINE is “;”. Text after this (e.g. references, or unused “products”) will be ignored.

\item {} 
Separator between rate coefficient and reaction is “:”.

\item {} 
lines beginning with “*” are comments (no “;” needed here)

\item {} 
lines beginning with “rcemis” are emission terms

\item {} 
lines beginning with “emisfiles” give name of  emission files, e.g. nox

\item {} 
Some coefficients are defined in GenIn.shorthand, e.g. TINV, LogTdiv300

\item {} 
Anything else is simply used as the rate coefficient. (Do not add spaces!)

\end{itemize}

Four  types of tracers/catalysts/yields are allowed, denoted by different types of parentheses:
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi )}
\makeatletter\def\p@enumii{\p@enumi \theenumi )}\makeatother
\item {} 
e.g. {[}OH{]} + VOC -\textgreater{} SOA   will put xnew(OH) into the loss rate of VOC, but will not change the loss rate of OH.

\item {} 
e.g. \{O2\} + OD -\textgreater{} OP   will ignore the O2 term. Make sure it is in the reaction rate though if needed!

\item {} 
e.g. OP + \textless{}O2\textgreater{} + \textless{}M\textgreater{} -\textgreater{} O3  will ignore the O2 and M term AND add their concentrations to the reaction rate (multiply it). This system is only used for these “special” species (O2, N2, M) as they must be pre-defined, e.g. O2(k), in boxChem and/or EMEP codes.

\item {} 
e.g. 1.36e-11 :   {[}OXYL{]} + {[}OH{]} = \textbar{}YCOXY(0)\textbar{}  ASOC\_ug1  + …  will replace the contents of the \textbar{}\textbar{} term with yield coefficients which will be updated each time-step in the EMEP model.  These variables (here YCOXY(0)) must be predefined in order for emep\_setup.py and the emep model to compile.

\end{enumerate}


\section{Species files}
\label{\detokenize{GenChemDoc_chem:species-files}}
The input to the GenChem.py script is GenIn\_Species.csv, but this
is assembled by do.GenChem from all needed  \_Species.csv files from
the base\_mechanisms and extra\_mechanisms sub-directories. For For
example, for a typical emep run with base EmChem19a, do.GenChem
appends EmChem19a\_Species.csv, SeaSalt\_Species.csv, and many more into
one GenIn\_Species.csv. The file contains columns with species
name, type, formula, and various settings related to dry and wet deposition

Example lines:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Spec,adv,formula,MW,DRY,WET,Groups,!Comments
*
RO2POOL,1,RO2POOL,xx,xx,xx,xx,!
OD,0,O,xx,xx,xx,xx,!
NO2,1,NO2,xx,NO2,xx,NOx;OX;OXN;daObs,!
MACR,1,CH2=CCH3CHO,xx,MEK,xx,RCHO;carbonyl;Hstar\PYGZus{}5p0e0;f0\PYGZus{}0p05;DRx\PYGZus{}2p6,!
BSOC\PYGZus{}ng1e2,2,C,12.,ALD,ROOH,Cstar:0.1;DeltaH:30.0;OM25;PCM;BSOA,\PYGZdq{}! semi\PYGZhy{}volatile OC from BVOC \PYGZdq{}
\end{sphinxVerbatim}

Further details can be found in the documentation article …


\section{Shorthands file}
\label{\detokenize{GenChemDoc_chem:shorthands-file}}
Shorthands are text-strings used in the Reactions.txt file, usually to represent commonly used rate-coefficients. The meaning of the text-string is given in \_Shorthand.txt file, e.g.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
XT           temp
FH2O         (1.0+1.4e\PYGZhy{}21*h2o*exp(2200.0*TINV))
KHO2RO2      2.91e\PYGZhy{}13*exp(1300.*TINV) ! MCM2001 ...
KMT12        IUPAC\PYGZus{}troe(2.8e\PYGZhy{}31*exp(2.6*Log300divT),2.0e\PYGZhy{}12,exp(\PYGZhy{}TEMP/472.),M,0.75\PYGZhy{}1.27*(\PYGZhy{}TEMP/472.)/LOG(10.))
\end{sphinxVerbatim}

In these examples, XT is just a character-saving replacement for temp, FH2O gives a more complex expression, which also uses the pre-defined variable TINV = 1/temp. KHO2RO2 is a common rate-coefficient, but here we see that comments are allowed - anything afer the 2nd term. FInally, the KMT12 term shows that complex fuction calls are also allowed. IMPORTANT - avoid white space in any terms!

\begin{sphinxadmonition}{warning}{Warning:}
**  NOTE !!
This user-guide is a work-in-progress manual on the GenChem system,
with this interim version produced for interested users, Jan. 2020.
**
\end{sphinxadmonition}


\chapter{Contributors}
\label{\detokenize{GenChemDoc_contributors:contributors}}\label{\detokenize{GenChemDoc_contributors::doc}}
The GenChem system was created over many years:
\begin{quote}

David Simpson, Norwegian Meteorological Institute \& Chalmers,
1998-2019: wrote original GenChem.pl scripts, the
boxChem system, assorted helper scripts (do.GenChem, boxplots.py, etc.),
and python3 conversion.

Alan Briolat, Stockholm Environment Institute at York,  2013: wrote the
first python version: GenChem.py.

Hannah Imhof, Chalmers,  2016: added extra flexibility and types
of arrays (e.g. factor groups), plus further scripts.  Added
CRI and MCM chemical mechanisms.

John Johansson, Chalmers, 2017-2019: improved organisation and
flexibility of GenChem system.

Robert Bergström, Chalmers and SMHI, 2017-2019: development of
chemical mechanisms (e.g. EmChem19 family, VBS schemes) for gas and aerosols.

Alvaro Valdebenito, Norwegian Meteorological Institute, 2018-2019,
various bug-fixes and updates. Added pollen.
\end{quote}

\begin{sphinxadmonition}{warning}{Warning:}
**  NOTE !!
This user-guide is a work-in-progress manual on the GenChem system,
with this interim version produced for interested users, Nov. 2019.
**
\end{sphinxadmonition}


\chapter{References}
\label{\detokenize{GenChemDoc_refs:references}}\label{\detokenize{GenChemDoc_refs::doc}}
\begin{sphinxadmonition}{warning}{Warning:}
**  NOTE !!
This user-guide is a work-in-progress manual on the GenChem system,
with this interim version produced for interested users, Nov. 2019.
**
\end{sphinxadmonition}

\begin{sphinxthebibliography}{SimpsonT}
\bibitem[Bergstrom2020]{GenChemDoc_refs:bergstrom2020}
Bergström, R.; Simpson, D.; others
chemical mechanism paper - in preparation
\bibitem[Simpson2012]{GenChemDoc_refs:simpson2012}
Simpson, D., Benedictow, A., Berge, H., Bergström, R., Emberson, L.
D., Fagerli, H., Flechard, C. R., Hayman, G. D., Gauss, M., Jonson,
J. E., Jenkin, M. E., Nyri, A., Richter, C., Semeena, V. S., Tsyro,
S., Tuovinen, J.-P., Valdebenito, Á., and Wind, P. The EMEP MSC-W
chemical transport model \textendash{} technical description \sphinxstyleemphasis{Atmos. Chem.
Physics}, 2012, 12, 7825-7865
\bibitem[SimpsonTuovinen2014]{GenChemDoc_refs:simpsontuovinen2014}
Simpson, D. and Tuovinen, J.-P., ECLAIRE Ecosystem Surface Exchange
model (ESX), in Transboundary particulate matter, photo-oxidants,
acidifying and eutrophying components. Status Report 1/2014, The Norwegian
Meteorological Institute, Oslo, Norway, pp 147-154, 2014
\bibitem[SimpsonEMEP2019]{GenChemDoc_refs:simpsonemep2019}
Simpson, D., Bergström, R., Tsyro, S. and Wind, P.,
Updates to the EMEP/MSC-W model, 2018\textendash{}2019, in EMEP Status Report 1/2019,
The Norwegian Meteorological Institute, Oslo, Norway, pp 145-155, www.emep.int, 2019
\end{sphinxthebibliography}



\renewcommand{\indexname}{Index}
\printindex
\end{document}